package Dispositivos;
import java.sql.Date;
import java.time.LocalDate;
import java.time.temporal.ChronoUnit;
import java.time.temporal.Temporal;

public class Dispositivo {
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// VARIABLES
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	private int thingID;
	private Date lastSupervision;
	private int numPastVulns;
	private boolean securityCertification;
	private String tipo;
	private int reputacionInicial;
	private String estadoActual;

	private final double peso_Supervision = 0.3;
	private final double peso_vulnes = 0.4;
	private final double peso_cert = 0.3;
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// CONSTRUCTOR
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public Dispositivo(){

	}
	
	public Dispositivo(final int thingID, final Date lastSupervision,
			final int numPastVulns, final boolean securityCertification, final String tipo, final int reputacionInicial, final String estadoActual){
		this.thingID = thingID;
		this.lastSupervision = lastSupervision;
		this.numPastVulns = numPastVulns;
		this.securityCertification = securityCertification;
		this.tipo = tipo;
		this.reputacionInicial = reputacionInicial;
		this.estadoActual = estadoActual;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	
	
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// GETTERS Y SETTERS
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public int getThingID(){
		return thingID;
	}
	
	public Date getLastSupervision(){
		return lastSupervision;
	}
	
	public int getNumPastVulns(){
		return numPastVulns;
	}
	
	public boolean getSecurityCertification(){
		return securityCertification;
	}

	public String getTipo(){
		return tipo;
	}

	public int getReputacionInicial(){
		return reputacionInicial;
	}

	public String getEstadoActual(){
		return estadoActual;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// CÁLCULO DE REPUTACIÓN
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	public double getPeso_Supervision() {
		return peso_Supervision;
	}


	public double getPeso_vulnes() {
		return peso_vulnes;
	}


	public double getPeso_cert() {
		return peso_cert;
	}

	public double calcular_reputacion(){
		double conf;
            
		double sumaPesos = 1;
		double sumaPonderada = 0.0;
		
		if(getSecurityCertification()){
			sumaPonderada+=getPeso_cert();
		}else{
			sumaPonderada+=0*getPeso_cert();
		}

		long diasTotales = ChronoUnit.DAYS.between((Temporal) getLastSupervision(), LocalDate.now());
		if(diasTotales >= 2*366){
			sumaPonderada += 0*getPeso_Supervision();
		}else{
			sumaPonderada += 1*getPeso_Supervision();
		}

		if (getNumPastVulns() > 20) {
			sumaPonderada += 0*getPeso_vulnes();
		}else{
			sumaPonderada += 1*getPeso_vulnes();
		}

		return sumaPonderada / sumaPesos;
	}
	
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// TO-STRING
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/* (non-Javadoc)
	 * @see java.lang.Object#toString()
	 * 
	@Override
	public String toString() {
		return "Thing [thingID=" + thingID + ", lastSupervision=" + lastSupervision + ", numPastVulns="
				+ numPastVulns + ", securityCertification=" + securityCertification + "]";
	} */
	
	/* (non-Javadoc)
	 * REWRITE
	 * @see java.lang.Object#toString()
	 * */
	@Override
	public String toString() {
		return "" + thingID + " --> [" + lastSupervision.toString() + " | " + numPastVulns + " | " + securityCertification + " | " + tipo + " | " + reputacionInicial + " | " + estadoActual + "]";
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// HASHCODE
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/* (non-Javadoc)
	 * @see java.lang.Object#hashCode()
	 */
	@Override
	public int hashCode() {
		final int prime = 31;
		int result = 1;
		result = prime * result + thingID;
		return result;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	// EQUALS
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	/* (non-Javadoc)
	 * @see java.lang.Object#equals(java.lang.Object)
	 */
	@Override
	public boolean equals(Object obj) {
		if (this == obj) {
			return true;
		}
		if (obj == null) {
			return false;
		}
		if (!(obj instanceof Dispositivo)) {
			return false;
		}
		Dispositivo other = (Dispositivo) obj;
		if (thingID != other.thingID) {
			return false;
		}
		return true;
	}
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
	///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

}
